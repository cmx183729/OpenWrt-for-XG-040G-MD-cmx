#
# ============================================================
#   OpenWrt/ImmortalWrt Config for Nokia XG-040G-MD
#   Target: Airoha AN7581 | Kernel: 6.12 | RAM: 512MB
#   Mode: No USB | Native Acceleration | Full Base System
# ============================================================
#

#
# --- 1. 目标平台与硬件定义 (来自您的基础代码) ---
#
CONFIG_TARGET_airoha=y
CONFIG_TARGET_airoha_an7581=y
CONFIG_TARGET_airoha_an7581_DEVICE_bell_xg-040g-md=y
CONFIG_ARCH_64BIT=y
CONFIG_aarch64=y
CONFIG_LINUX_6_12=y

# 硬件驱动 (NPU/PHY) - 核心驱动
CONFIG_PACKAGE_airoha-en7581-npu-firmware=y
CONFIG_PACKAGE_kmod-phy-airoha-en8811h=y
CONFIG_PACKAGE_kmod-i2c-an7581=y

#
# --- 2. 基础系统设置 (Base System) ---
#
CONFIG_DEFAULT_base-files=y
CONFIG_DEFAULT_busybox=y                  # 核心工具集
CONFIG_DEFAULT_ca-bundle=y                # 根证书 (wget/curl必须)
CONFIG_DEFAULT_logd=y                     # 日志服务
CONFIG_DEFAULT_procd=y                    # 进程管理
CONFIG_DEFAULT_uci=y                      # 配置管理
CONFIG_DEFAULT_urandom-seed=y             # 随机数种子
CONFIG_DEFAULT_urngd=y                    # 随机数守护进程
CONFIG_DEFAULT_netifd=y                   # 网络接口管理
CONFIG_DEFAULT_mtd=y                      # Flash工具
CONFIG_DEFAULT_fstools=y                  # 文件系统工具
CONFIG_DEFAULT_block-mount=y              # 挂载工具 (即使无USB，挂载Overlay也需要)
CONFIG_DEFAULT_libc=y
CONFIG_DEFAULT_libgcc=y
CONFIG_PACKAGE_uboot-envtools=y           # U-Boot 环境变量工具
CONFIG_PACKAGE_uclient-fetch=y            # 下载工具库
CONFIG_PACKAGE_kmod-gpio-button-hotplug=y # 物理按钮支持
CONFIG_PACKAGE_kmod-leds-gpio=y           # LED 灯光控制
CONFIG_PACKAGE_ubi-utils=y                # UBI 分区管理工具

# 分区与文件系统 (适配 256MB 真实闪存)
CONFIG_TARGET_ROOTFS_SQUASHFS=y
CONFIG_TARGET_SQUASHFS_BLOCK_SIZE=256
CONFIG_TARGET_SQUASHFS_BLOCK_READERS=4
CONFIG_TARGET_SQUASHFS_SMALL_READERS=4
CONFIG_TARGET_UBIFS_FREE_SPACE_FIXUP=y    # 首次启动修复空闲空间 (关键)
CONFIG_TARGET_UBIFS_JOURNAL_SIZE=""       # 使用默认日志大小
CONFIG_MTD_UBI=y
CONFIG_UBIFS_FS=y
CONFIG_FSTOOLS_UBIFS_EXTROOT=y
CONFIG_TARGET_ROOTFS_PARTSIZE=256

#
# --- 3. 网络基础与原生加速 (Network) ---
#
CONFIG_IPV6=y
CONFIG_PACKAGE_dnsmasq=y                  # DNS/DHCP 服务
CONFIG_PACKAGE_ip-full=y                  # 完整版 IP 工具
CONFIG_DEFAULT_odhcp6c=y                  # IPv6 客户端
CONFIG_DEFAULT_odhcpd-ipv6only=y          # IPv6 服务器
CONFIG_PACKAGE_nftables=y                 # 新一代防火墙核心
CONFIG_PACKAGE_firewall4=y                # 防火墙前端
CONFIG_PACKAGE_kmod-nfnetlink=y
CONFIG_PACKAGE_kmod-nft-core=y
CONFIG_PACKAGE_kmod-nft-nat=y
CONFIG_PACKAGE_kmod-nf-flow=y
CONFIG_PACKAGE_ethtool-full=y             # 网卡调试工具

# [核心加速] 替代 TurboACC 插件
# 开启 NPU 硬件/软件流量卸载
CONFIG_PACKAGE_kmod-nft-offload=y
# 开启 BBR 拥塞控制
CONFIG_PACKAGE_kmod-tcp-bbr=y

#
# --- 4. 包管理器 (APK) ---
#
CONFIG_PACKAGE_apk=y
CONFIG_DEFAULT_apk-tools=y
CONFIG_PACKAGE_apk-mbedtls=y
CONFIG_DEFAULT_openwrt-keyring=y

#
# ============================================================
#   用户插件区 (User Plugins)
# ============================================================
#

# --- [1] 科学上网 (Passwall) ---
CONFIG_PACKAGE_luci-app-passwall=y
CONFIG_PACKAGE_luci-i18n-passwall-zh-cn=y
# 强制禁用 Trojan-Plus 防止报错
# CONFIG_PACKAGE_trojan-plus is not set
# CONFIG_PACKAGE_luci-app-passwall_INCLUDE_Trojan_Plus is not set

# --- [2] 端口转发 (Lucky) ---
CONFIG_PACKAGE_luci-app-lucky=y
CONFIG_PACKAGE_luci-i18n-lucky-zh-cn=y

# --- [3] IPTV 转换 (rtp2httpd) ---
CONFIG_PACKAGE_luci-app-rtp2httpd=y

# --- [4] 自动端口映射 (UPnP) ---
CONFIG_PACKAGE_miniupnpd=y
CONFIG_PACKAGE_luci-app-upnp=y
CONFIG_PACKAGE_luci-i18n-upnp-zh-cn=y

# --- [5] 内存优化 (ZRAM) ---
# 512M 内存必备
CONFIG_PACKAGE_zram-swap=y
CONFIG_PACKAGE_luci-app-zram=y
CONFIG_PACKAGE_luci-i18n-zram-zh-cn=y

# --- [6] 定时重启/断网重连 (Watchcat) ---
CONFIG_PACKAGE_luci-app-watchcat=y
CONFIG_PACKAGE_luci-i18n-watchcat-zh-cn=y

# --- [7] 简单流控 (EQoS) ---
CONFIG_PACKAGE_luci-app-eqos=y
CONFIG_PACKAGE_luci-i18n-eqos-zh-cn=y

# --- [8] IP/MAC 绑定 (Arpbind) ---
CONFIG_PACKAGE_luci-app-arpbind=y
CONFIG_PACKAGE_luci-i18n-arpbind-zh-cn=y

# --- [9] 流量统计 (Nlbwmon) ---
CONFIG_PACKAGE_luci-app-nlbwmon=y
CONFIG_PACKAGE_luci-i18n-nlbwmon-zh-cn=y

# --- [10] 界面主题 (Argon) ---
CONFIG_PACKAGE_luci-theme-argon=y

# --- [11] 网页终端 (Ttyd) ---
CONFIG_PACKAGE_luci-app-ttyd=y
CONFIG_PACKAGE_luci-i18n-ttyd-zh-cn=y

# --- [12] 常用工具箱 ---
CONFIG_PACKAGE_nano=y
CONFIG_PACKAGE_htop=y
CONFIG_PACKAGE_curl=y
CONFIG_PACKAGE_wget-ssl=y
CONFIG_PACKAGE_bash=y

#
# ============================================================
#   系统组件 (System) - 无 USB
# ============================================================
#

# 拨号与 SSH
CONFIG_PACKAGE_ppp=y
CONFIG_PACKAGE_ppp-mod-pppoe=y
CONFIG_PACKAGE_dropbear=y
CONFIG_DROPBEAR_SMALL_CODE=y
CONFIG_DROPBEAR_ED25519=y
CONFIG_DROPBEAR_CURVE25519=y
CONFIG_PACKAGE_openssh-sftp-server=y

# 管理界面设置 (HTTP only)
CONFIG_PACKAGE_luci=y
# CONFIG_PACKAGE_luci-ssl is not set
CONFIG_LUCI_LANG_zh_Hans=y
CONFIG_PACKAGE_luci-i18n-base-zh-cn=y
CONFIG_PACKAGE_luci-compat=y

